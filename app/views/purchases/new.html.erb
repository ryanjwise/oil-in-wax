<h1>Checkout</h1>

<%= form_tag purchases_path do %>
  <% if flash[:error].present? %>
    <div id="error_explanation">
      <p><%= flash[:error] %></p>
    </div>
  <% end %>
  <article>
    <% @items.each do |item| %>
      <p><%= "#{item.quantity}x #{item.candle.name} @ #{item.candle.price} for #{number_to_currency(item.candle.price*item.quantity)}" %></p>
    <% end %>
    <p><strong>Total: <%= pretty_amount(@amount) %></strong></p>
  </article>

  <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
          data-key="<%= Rails.application.credentials.dig(:stripe, :publishable_key) %>"
          data-description="<%= @description %>"
          data-amount="<%= @amount %>"
          data-email="<%= current_user.email %>"
          data-locale="auto"></script>
<% end %>